# CoKeyboard 智能语音键盘

## 项目概述

CoKeyboard 是一款 iOS 键盘扩展应用，通过语音识别技术实现语音输入功能。由于 iOS 键盘扩展无法直接使用麦克风，采用了主 App 协同架构来完成录音和语音处理。

## 操作流程（UE）

```
主流程：
用户点击键盘语音按钮
        ↓                      
通知主APP开启转写音频采集，并传递当前输入框完整文本
- 如果主APP未启动系统录音，因为iOS系统限制需要跳转主APP开启，使用[开启主APP录制流程]
        ↓
展示声波图形
        ↓
用户点击声波完成转写音频采集（主APP不停止系统录音，但是不采集音频）
        ↓
键盘展示 Thinking 状态，等待主APP处理完成
        ↓
主APP使用 Whisper 转写 (WhisperService)
        ↓
主APP使用 (可选) LLM 润色 (PolishService)
        ↓
主APP使用 结果写入共享存储 (RecordingSessionManager)，通知键盘拓展
        ↓
键盘读取结果，插入文本，展示默认等待录制图表

开启主APP录制流程：
开始录制时，键盘拓展发现，系统录音为开启
        ↓
通过 URL Scheme 打开主 App (coapp://start-recording)，并记录来源APP bundleID
        ↓
主 App (CoKeyboardApp) 开始后台录音
        ↓
跳回唤起的APP（当前键盘正常打开，键盘自动进入录制模式）

录音主要的状态说明
1. 系统录制关闭
- 首次使用键盘，未点击录制按钮
- 超过用户设置的待机时长，自动停止系统录制
- 被其他软件抢占或者系统自动停止录制
2. 系统录制开启，并采集音频
- 用户点击录制按钮后，发现未开启系统录制，跳转主APP启动系统录制，并开始采集
- 用户点击录制，主APP已经开启系统录制，直接开始采集
3. 系统录制开启，但未采集音频
- 用户点击录制结束，停止音频采集，但不主动停止系统录制
- 用户退出键盘，再次进入键盘，上一次系统采集待机未结束


```

### 用户界面（UX）
1. 整体界面应该和系统的键盘融为一体，兼容iOS26液态玻璃
2. 主按键 宽高比3:1，有三种状态：等待录制 （录音图表） ，录制中（音频声波），处理中（Thinking）
3. 第一排，操作按钮， 整体较小，只展示图表，图表不要占满整个按钮
右对齐按钮：
- @
- 空格
- 删除
左对齐按钮：
- 收起键盘
4. 右下角展示，本次启动键盘使用的 Voice、润色 Token数量
